<!DOCTYPE html>
<html lang="ko">

<head>
    <%- include ("../partials/header.ejs") %>
</head>

<body class="layout-boxed alt-menu">

    <%- include ("../partials/loader.ejs") %>

        <%- include ("../partials/nav.ejs") %>

            <!--  BEGIN MAIN CONTAINER  -->
            <div class="main-container sidebar-closed " id="container">

                <div class="overlay"></div>
                <div class="search-overlay"></div>

                <%- include ("../partials/sidebar.ejs") %>

                    <!--  BEGIN CONTENT AREA  -->
                    <div id="content" class="main-content">
                        <div class="layout-px-spacing">

                            <div class="middle-content container-xxl p-0">
                                <!-- BREADCRUMB -->
                                <div class="page-meta">
                                    <nav class="breadcrumb-style-one" aria-label="breadcrumb">
                                        <ol class="breadcrumb">
                                            <li class="breadcrumb-item"><a href="/users">매니저 관리</a></li>
                                            <li class="breadcrumb-item active" aria-current="page">매니저 등록</li>
                                        </ol>
                                    </nav>
                                </div>
                                <!-- /BREADCRUMB -->

                                <div class="row layout-spacing">
                                    <div class="col-lg-12 layout-top-spacing">
                                        <div class="col-lg-12">
                                            <div class="statbox widget box box-shadow">
                                                <form method="post">
                                                    <div class="widget-content widget-content-area">
                                                        <div class="row">
                                                            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                                                <h6>ID</h6>
                                                            </div>
                                                        </div>

                                                        <div class="row layout-spacing">
                                                            <div class="col-12">

                                                                <div class="form-group">
                                                                    <label for="userid"
                                                                        class="visually-hidden">Text</label>
                                                                    <input id="userid" type="text" name="userid"
                                                                        placeholder="" class="form-control" required>
                                                                    <button type="button"
                                                                        class="btn btn-outline-info mt-2 mb-2"
                                                                        onclick="checkID()">중복확인</button>
                                                                </div>

                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                                                <h6>비밀번호</h6>
                                                            </div>
                                                        </div>

                                                        <div class="row layout-spacing">
                                                            <div class="col-12">

                                                                <div class="form-group">
                                                                    <label for="password"
                                                                        class="visually-hidden">Text</label>
                                                                    <input id="password" type="password" name="password"
                                                                        placeholder="" class="form-control" required>
                                                                </div>

                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                                                <h6>비밀번호 확인</h6>
                                                            </div>
                                                        </div>

                                                        <div class="row layout-spacing">
                                                            <div class="col-12">

                                                                <div class="form-group">
                                                                    <label for="confirm_password"
                                                                        class="visually-hidden">Text</label>
                                                                    <input id="confirm_password" type="password"
                                                                        name="confirm_password" placeholder=""
                                                                        class="form-control" required>
                                                                </div>

                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                                                <h6>이름</h6>
                                                            </div>
                                                        </div>

                                                        <div class="row layout-spacing">
                                                            <div class="col-12">

                                                                <div class="form-group">
                                                                    <label for="userName"
                                                                        class="visually-hidden">Text</label>
                                                                    <input id="userName" type="text" name="userName"
                                                                        placeholder="" class="form-control" required>
                                                                </div>

                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                                                <h6>연락처</h6>
                                                            </div>
                                                        </div>

                                                        <div class="row layout-spacing">
                                                            <div class="col-12">

                                                                <div class="form-group">
                                                                    <label for="phoneNum"
                                                                        class="visually-hidden">Text</label>
                                                                    <input id="phoneNum" type="text" name="phoneNum"
                                                                        placeholder="" class="form-control" required>
                                                                </div>

                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                                                <h6>Email</h6>
                                                            </div>
                                                        </div>

                                                        <div class="row layout-spacing">
                                                            <div class="col-12">

                                                                <div class="form-group">
                                                                    <label for="email"
                                                                        class="visually-hidden">Text</label>
                                                                    <input id="email" type="text" name="email"
                                                                        placeholder="" class="form-control" required>
                                                                </div>

                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                                                <h6>권한</h6>
                                                            </div>
                                                        </div>

                                                        <div class="row layout-spacing">
                                                            <div class="col-12 ">
                                                                <div class="table-responsive">
                                                                    <table
                                                                        class="table table-hover table-striped table-bordered">
                                                                        <thead>
                                                                            <tr>
                                                                                <th class="text-center" scope="col">권한명
                                                                                </th>
                                                                                <th class="text-center" scope="col">등록
                                                                                </th>
                                                                                <th class="text-center" scope="col">조회
                                                                                </th>
                                                                                <th class="text-center" scope="col">수정
                                                                                </th>
                                                                                <th class="text-center" scope="col">삭제
                                                                                </th>
                                                                                <th class="text-center" scope="col">ALL
                                                                                </th>
                                                                            </tr>
                                                                            <tr aria-hidden="true"
                                                                                class="mt-3 d-block table-row-hidden">
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr>
                                                                                <td class="text-center">
                                                                                    <span
                                                                                        class="media-body align-self-center">공지사항
                                                                                        관리</span>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-secondary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission1"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission1_add">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-primary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission1"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission1_read">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-info form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission1"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission1_edit">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-success form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission1"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission1_del">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-danger form-check-inline">
                                                                                        <input class="form-check-input"
                                                                                            id="permission1"
                                                                                            type="checkbox" value='1'>
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="text-center">
                                                                                    <span
                                                                                        class="media-body align-self-center">후기
                                                                                        관리</span>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-secondary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission2"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission2_add">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-primary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission2"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission2_read">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-info form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission2"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission2_edit">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-success form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission2"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission2_del">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-danger form-check-inline">
                                                                                        <input class="form-check-input"
                                                                                            id="permission2"
                                                                                            type="checkbox" value='1'>
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="text-center">
                                                                                    <span
                                                                                        class="media-body align-self-center">폐차
                                                                                        고객 관리</span>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-secondary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission3_1"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission3_1_add">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-primary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission3_1"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission3_1_read">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-info form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission3_1"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission3_1_edit">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-success form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission3_1"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission3_1_del">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-danger form-check-inline">
                                                                                        <input class="form-check-input"
                                                                                            id="permission3_1"
                                                                                            type="checkbox" value='1'>
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="text-center">
                                                                                    <span
                                                                                        class="media-body align-self-center">수출
                                                                                        고객 관리</span>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-secondary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission3_2"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission3_2_add">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-primary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission3_2"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission3_2_read">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-info form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission3_2"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission3_2_edit">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-success form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission3_2"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission3_2_del">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-danger form-check-inline">
                                                                                        <input class="form-check-input"
                                                                                            id="permission3_2"
                                                                                            type="checkbox" value='1'>
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="text-center">
                                                                                    <span
                                                                                        class="media-body align-self-center">앱
                                                                                        이미지 관리</span>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-secondary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission4"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission4_add">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-primary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission4"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission4_read">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-info form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission4"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission4_edit">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-success form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission4"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission4_del">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-danger form-check-inline">
                                                                                        <input class="form-check-input"
                                                                                            id="permission4"
                                                                                            type="checkbox" value='1'>
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="text-center">
                                                                                    <span
                                                                                        class="media-body align-self-center">차량
                                                                                        정보 관리</span>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-secondary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission5"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission5_add">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-primary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission5"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission5_read">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-info form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission5"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission5_edit">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-success form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission5"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission5_del">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-danger form-check-inline">
                                                                                        <input class="form-check-input"
                                                                                            id="permission5"
                                                                                            type="checkbox" value='1'>
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="text-center">
                                                                                    <span
                                                                                        class="media-body align-self-center">부속품
                                                                                        관리</span>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-secondary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission6"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission6_add">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-primary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission6"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission6_read">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-info form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission6"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission6_edit">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-success form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission6"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission6_del">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-danger form-check-inline">
                                                                                        <input class="form-check-input"
                                                                                            id="permission6"
                                                                                            type="checkbox" value='1'>
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="text-center">
                                                                                    <span
                                                                                        class="media-body align-self-center">협력사
                                                                                        관리</span>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-secondary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission7"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission7_add">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-primary form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission7"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission7_read">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-info form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission7"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission7_edit">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-success form-check-inline">
                                                                                        <input
                                                                                            class="form-check-input permission7"
                                                                                            type="checkbox" value='1'
                                                                                            name="permission"
                                                                                            id="permission7_del">
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div
                                                                                        class="form-check form-check-danger form-check-inline">
                                                                                        <input class="form-check-input"
                                                                                            id="permission7"
                                                                                            type="checkbox" value='1'>
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                                                <h6>메모</h6>
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-12">

                                                                <div class="form-group">
                                                                    <label for="note"
                                                                        class="visually-hidden">Text</label>
                                                                    <input id="note" type="text" name="note"
                                                                        placeholder="" class="form-control">
                                                                </div>

                                                            </div>
                                                        </div>

                                                        <div class="row layout-top-spacing">
                                                            <div class="col-12">

                                                                <div class="form-group">
                                                                    <button class="btn btn-outline-success mb-2 me-4"
                                                                        type="button" onclick="add_user()">저장</button>
                                                                    <button class="btn btn-outline-danger mb-2 me-4"
                                                                        type="button" onclick="cancel()">취소</button>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <%- include ("../partials/footer.ejs") %>

                    </div>
                    <!--  END CONTENT AREA  -->
            </div>
            <!-- END MAIN CONTAINER -->

            <%- include ("../partials/commonScrpits.ejs") %>

                <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->
                <script>
                    for (let i = 1; i <= 7; i++) {
                        if (i == 3) {
                            checkall('permission3_1', 'permission3_1');
                            checkall('permission3_2', 'permission3_2');
                            continue;
                        }
                        checkall('permission' + i, 'permission' + i);
                    }

                    async function add_user() {
                        let password = $('#password').val();
                        let confirm_password = $('#confirm_password').val();
                        if (!(password == confirm_password)) return alert("비밀번호가 일치하지 않습니다.");

                        let data = {};
                        data.userid = $('#userid').val();
                        data.password = password;
                        data.userName = $('#userName').val();
                        data.phoneNum = $('#phoneNum').val();
                        data.email = $('#email').val();
                        if (data.email.length > 25) return alert("email은 25자를 넘길 수 없습니다.");
                        data.note = $('#note').val();
                        data.permission1 = permission_calc("permission1");
                        data.permission2 = permission_calc("permission2");
                        data.permission3_1 = permission_calc("permission3_1");
                        data.permission3_2 = permission_calc("permission3_2");
                        data.permission4 = permission_calc("permission4");
                        data.permission5 = permission_calc("permission5");
                        data.permission6 = permission_calc("permission6");
                        data.permission7 = permission_calc("permission7");

                        await fetch(location.href, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data),
                            redirect: "follow"
                        })
                            .then((response) => {
                                // console.log(response);
                                if (response.ok) return window.location.href = response.url;
                                else alert("추가 실패!!");
                            })
                            .catch((err) => {
                                console.error(err)
                            });
                    }

                    function permission_calc(permission) {
                        let result = 0;
                        let add_permission = document.getElementById(permission + '_add');
                        let read_permission = document.getElementById(permission + '_read');
                        let edit_permission = document.getElementById(permission + '_edit');
                        let del_permission = document.getElementById(permission + '_del');
                        // console.log(permission);

                        if (add_permission.checked) result |= 1 << 3;
                        if (read_permission.checked) result |= 1 << 2;
                        if (edit_permission.checked) result |= 1 << 1;
                        if (del_permission.checked) result |= 1 << 0;

                        return result;
                    }

                    async function checkID() {
                        let userid = $('#userid').val();
                        console.log(userid);

                        let url = '/users/checkID';
                        await fetch(url, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ userid }),
                            redirect: "follow"
                        })
                            .then((response) => {
                                // console.log(response);
                                if (response.ok) return alert("사용가능한 ID입니다.");
                                else return alert("사용할 수 없는 ID입니다.")
                            })
                            .catch((err) => {
                                console.log(err)
                            });
                    }
                </script>
                <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->
</body>

</html>